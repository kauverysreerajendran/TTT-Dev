734:                     data-brass-missing-qty="{{ data.brass_audit_missing_qty|default:0 }}"
736:                     data-aql-limit="{{ data.aql_limit }}"
737:                     data-sample-qty="{{ data.sample_qty }}">
853:                           value="{{ data.brass_audit_missing_qty|default_if_none:'' }}"
1001:                                 data-aql-limit="{{ data.aql_limit }}"
1002:                                 data-sample-qty="{{ data.sample_qty }}"
1049:                             data-brass-missing-qty="{{ data.brass_audit_missing_qty|default:0 }}">
1197:               Missing Qty: <span id="modalMissingQty" style="font-weight:bold; color:#d32f2f;"></span> /
1231:                     Missing Qty: <span id="trayScanModalMissingQty" style="font-weight:bold; color:#d32f2f; font-size:13px;"></span> /
1235:                   <div class="aql-info" style="margin-bottom: 10px;">
1236:                     <span style="font-weight:600; color:#028084; font-size:13px;">AQL Limit:</span>
1237:                     <span id="trayScanModalAqlLimit" style="font-weight:bold; color:#e67e22; font-size:13px;"></span>
1239:                     <span style="font-weight:600; color:#028084; font-size:13px;">Sample Qty:</span>
1240:                     <span id="trayScanModalSampleQty" style="font-weight:bold; color:#388e3c; font-size:13px;"></span>
1884:       const brassMissingQty = row ? row.getAttribute('data-brass-missing-qty') : "0";
1908:       if (document.getElementById('modalMissingQty')) document.getElementById('modalMissingQty').textContent = "-";
1923:       document.getElementById('modalMissingQty').textContent = brassMissingQty || '';
2690:         const missingQty = row.getAttribute('data-brass-missing-qty') || '';
2757:             const missingQtyAttr = row.getAttribute('data-brass-missing-qty');
2767:             const missingQty = missingQtyAttr || '0';
2769:             console.log('ðŸ“Š Setting quantities:', { lotQty, physicalQty, missingQty });
2774:               const missingQtySpan = document.getElementById('trayScanModalMissingQty');
2782:               if (missingQtySpan) {
2783:                 missingQtySpan.textContent = missingQty;
2784:                 console.log('âœ… Set Missing Qty:', missingQty);
2793:             document.getElementById('trayScanModalAqlLimit').textContent = row.getAttribute('data-aql-limit') || 'N/A';
2794:             document.getElementById('trayScanModalSampleQty').textContent = row.getAttribute('data-sample-qty') || 'N/A';
4733:   const missingQtyAttr = row.getAttribute('data-brass-missing-qty');
4737:   const missingQty = missingQtyAttr || '0';
4742:     missingQty,
4749:     const missingQtySpan = document.getElementById('trayScanModalMissingQty');
4757:     if (missingQtySpan) {
4758:       missingQtySpan.textContent = missingQty;
4759:       console.log('âœ… Set Missing Qty:', missingQty);
4893:       <button id="proceedButton" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 30px;">
4947:     const aqlLimit = parseFloat(document.getElementById('trayScanModalAqlLimit').textContent) || 0;
4957:       if (aqlLimit > 0 && totalQty > aqlLimit) {
5351:     document.getElementById("proceedButton").disabled = false;
5360:     document.getElementById("proceedButton").disabled = false;
5435:           document.getElementById("proceedButton").disabled = false;
5461:     document.getElementById("proceedButton").disabled = false;
5470:     document.getElementById("proceedButton").disabled = false;
5481:     document.getElementById("proceedButton").disabled = false;
5524:       document.getElementById("proceedButton").disabled = false;
5534:     document.getElementById("proceedButton").disabled = false;
5687:       document.getElementById("proceedButton").disabled = false;
5696:     document.getElementById("proceedButton").disabled = false;
6544: const proceedButton = document.getElementById("proceedButton");
6545: if (proceedButton) {
6546:   proceedButton.addEventListener("click", () => {
6547:     if (proceedButton.disabled) return;
6548:     proceedButton.disabled = true;
6564:         proceedButton.disabled = false;
6577:         proceedButton.disabled = false;
6583:       let missingQty = 0;
6586:         const missingQtyInput = currentRow.querySelector('.missing-qty-input');
6587:         missingQty = missingQtyInput ? parseInt(missingQtyInput.value) || 0 : 0;
6594:       console.log(`ðŸ” [Batch Rejection] Checking missing qty: ${missingQty} for lot: ${lotId}`);
6599:       if (missingQty > 0) {
6601:         console.log('ðŸ”— Showing delink modal for batch rejection with missing qty:', missingQty);
6611:         showBatchRejectionDelinkModal(lotId, batchId, missingQty, lotRejectionRemarks, totalQty);
6627: function showBatchRejectionDelinkModal(lotId, batchId, missingQty, lotRejectionRemarks, totalQty) {
6628:   console.log('ðŸ”— Showing batch rejection delink modal for lot:', lotId, 'missing qty:', missingQty);
6638:   const missingQtySpan = document.getElementById('delinkMissingQty');
6645:   if (missingQtySpan) missingQtySpan.textContent = missingQty;
6671:   modal.dataset.missingQty = missingQty;
6721:         if (confirm('Confirm Batch Rejection with Delink\n\nThis will delink ' + missingQty + ' pieces and REJECT the entire batch. Are you sure?')) {
6730:   fetchDelinkCalculationForBatchRejection(lotId, missingQty);
6734: function fetchDelinkCalculationForBatchRejection(lotId, missingQty) {
6735:   console.log('ðŸ“¡ Fetching delink calculation for batch rejection - lot:', lotId, 'missing qty:', missingQty);
6742:   const apiUrl = `/brass_audit/brass_audit_tray_delink_top_tray_calc/?lot_id=${encodeURIComponent(lotId)}&missing_qty=${missingQty}`;
7022:       const missingQty = modal ? modal.dataset.missingQty : null;
7032:         missingQty, 
7338:       document.getElementById("proceedButton").disabled = false;
7346:     document.getElementById("proceedButton").disabled = false;
7432:       const missingQty = modal ? modal.dataset.missingQty : null;
7638:         const missingQtyInput = row.querySelector('.missing-qty-input');
7643:           missingQtyInput.disabled = false;
7647:         missingQtyInput.addEventListener('input', function () {
7648:           let missingQty = parseInt(missingQtyInput.value, 10);
7649:           if (isNaN(missingQty) || missingQty < 0) {
7653:           if (missingQty > totalQty) {
7654:             missingQtyInput.value = totalQty;
7655:             missingQty = totalQty;
7657:           physicalQtyInput.value = totalQty - missingQty;
7662:             missingQtyInput.disabled = false;
7663:             missingQtyInput.focus();
7665:             missingQtyInput.value = '';
7666:             missingQtyInput.disabled = false;
7675:           let missingQty = missingQtyInput.value.trim();
7681:           if (!missingQty || isNaN(missingQty) || parseInt(missingQty) < 0) {
7694:               missing_qty: missingQty
7702:               missingQtyInput.disabled = true;
7705:                 physicalQtyInput.value = totalQty - parseInt(missingQty);
7969:                 Missing Quantity: <span id="delinkMissingQty">0</span> pieces detected
8099:     const missingQtyInput = row ? row.querySelector('.missing-qty-input') : null;
8100:     const missingQty = missingQtyInput ? parseInt(missingQtyInput.value) || 0 : 0;
8101:     console.log('ðŸ“Š Missing quantity:', missingQty);
8103:     if (missingQty > 0) {
8104:         console.log('ðŸ”— Showing delink modal for missing qty:', missingQty);
8105:         showDelinkModal(lotId, missingQty);
8177: function showDelinkModal(lotId, missingQty) {
8178:     console.log('ðŸ”— Showing compact delink modal for lot:', lotId, 'missing qty:', missingQty);
8187:     const missingQtySpan = document.getElementById('delinkMissingQty');
8193:     if (missingQtySpan) missingQtySpan.textContent = missingQty;
8206:     modal.dataset.missingQty = missingQty;
8208:     fetchDelinkCalculation(lotId, missingQty);
8211: function fetchDelinkCalculation(lotId, missingQty) {
8212:     console.log('ðŸ“¡ Fetching delink calculation for lot:', lotId, 'missing qty:', missingQty);
8219:     const apiUrl = `/brass_audit/brass_audit_tray_delink_top_tray_calc/?lot_id=${encodeURIComponent(lotId)}&missing_qty=${missingQty}`;
8850:             const missingQty = delinkModal ? delinkModal.dataset.missingQty : null;
8852:             console.log('ðŸ“Š Confirming delink for lot:', lotId, 'missing qty:', missingQty);
9917:       'img[alt="Edit"], img[alt="Delete"], img[alt="Edit Disabled"], img[alt="Delete Disabled"], .fa-filter, .hold-toggle-btn, button:not(#closeTrayScanModal_DayPlanning):not(#trayValidateBtn):not(#trayScanRedoBtn):not(.tray-scan-btn):not(#draftButton):not(#proceedButton):not(#cancelButton), a:not(.tray-scan-btn-Jig)'